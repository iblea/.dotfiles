#!/bin/bash


CLAUDE_OPT="a"

if [ $# -eq 0 ]; then
    CLAUDE_OPT="a"
else
    if [ $# -eq 1 ] && ( [ "$1" = "-h" ] || [ "$1" = "--help" ] ); then
        claude --help
        exit 0
    fi
    case "$1" in
        s|u|su|a|au|h|hu|o|ou|d|du)
            CLAUDE_OPT="$1"
            shift
            ;;
        *)
            # CLAUDE_OPT="s"
            echo -n ""
            ;;
    esac
fi

CLAUDE_OPT=$(echo $CLAUDE_OPT | sed 's/.*/\L&/')
OTHER_OPTS=()

for (( i=1; i<=$#; i++ )); do
    opt="${!i}"
    if [[ "$opt" = "--dan" ]] || [[ "$opt" = "-d" ]] || [[ "$opt" = "dan" ]]; then
        OTHER_OPTS+=("--dangerously-skip-permissions")
    elif [[ "${opt}" = "--cd" ]] || [[ "${opt}" = "-cd" ]] || [[ "${opt}" = "cd" ]]; then
        ((i++))
        if [ $i -gt $# ]; then
            echo "missing directory argument for --cd option"
            exit 1
        fi
        opt="${!i}"
        if [ ! -d "$opt" ]; then
            echo "directory not found: $opt"
            exit 1
        fi
        cd "$opt"
    elif [[ "${opt}" = "vs" ]] || [[ "${opt}" = "-vs" ]] || [[ "${opt}" = "vsc" ]] || [[ "${opt}" = "-vsc" ]]; then
        if [ -n "$GIT_ASKPASS" ]; then
            export EDITOR="code"
        fi
    else
        OTHER_OPTS+=("$opt")
    fi
done

# if ( grep -q -- "--dan" <<< "$*" ); then
#     BYPASS_OPT="--dangerously-skip-permissions"
#     shift
# fi


# PROMPT_PATH="$HOME/.dotfiles/prompt/global_prompt.md"
# ~/.claude/CLAUDE.md -> @global_prompt.md
# ln -s $HOME/.dotfiles/prompt/global_prompt.md $HOME/.claude/
# if [ -n "$(grep '^@global_prompt.md$' CLAUDE.md)" ]; then
#     echo -e "hello world!\n$(cat $HOME/.claude/CLAUDE.md)" > $HOME/.claude/CLAUDE.md
#     echo -e "@global_prompt.md\n\n$(cat $HOME/.claude/CLAUDE.md)" > $HOME/.claude/CLAUDE.md
# fi
PROMPT_PATH=""

if [ -z "$EDITOR" ]; then
    if [ "$(command -v nvim)" ]; then
        export EDITOR="nvim"
    else
        export EDITOR="vim"
    fi
    # if [ -n "$GIT_ASKPASS" ]; then
    #     export EDITOR="code"
    # fi
fi

if [ "$CLAUDE_OPT" = "s" ]; then
    if [ -f "$PROMPT_PATH" ] ;then
        claude --model=sonnet --append-system-prompt "$(cat $PROMPT_PATH)" ${OTHER_OPTS[@]}
    else
        claude --model=sonnet ${OTHER_OPTS[@]}
    fi
elif [ "$CLAUDE_OPT" = "u" ] || [ "$CLAUDE_OPT" = "su" ]; then
    if [ -f "$PROMPT_PATH" ] ;then
        claude --model=sonnet --append-system-prompt "/sc:implement --ultrathink --seq --c7 --play --iterative --with-tests$(echo )$(cat $PROMPT_PATH)" ${OTHER_OPTS[@]}
    else
        claude --model=sonnet --append-system-prompt "/sc:implement --ultrathink --seq --c7 --play --iterative --with-tests" ${OTHER_OPTS[@]}
    fi
elif [ "$CLAUDE_OPT" = "a" ] || [ "$CLAUDE_OPT" = "o" ] || [ "$CLAUDE_OPT" = "d" ]; then
    if [ -f "$PROMPT_PATH" ] ;then
        claude --model=opus --append-system-prompt "$(cat $PROMPT_PATH)" ${OTHER_OPTS[@]}
    else
        claude --model=opus ${OTHER_OPTS[@]}
    fi
elif [ "$CLAUDE_OPT" = "au" ] || [ "$CLAUDE_OPT" = "ou" ] || [ "$CLAUDE_OPT" = "du" ]; then
    if [ -f "$PROMPT_PATH" ] ;then
        claude --model=opus --append-system-prompt "/sc:implement --ultrathink --seq --c7 --play --iterative --with-tests$(echo )$(cat $PROMPT_PATH)" ${OTHER_OPTS[@]}
    else
        claude --model=opus --append-system-prompt "/sc:implement --ultrathink --seq --c7 --play --iterative --with-tests" ${OTHER_OPTS[@]}
    fi
elif [ "$CLAUDE_OPT" = "h" ]; then
    if [ -f "$PROMPT_PATH" ] ;then
        claude --model=haiku --append-system-prompt "$(cat $PROMPT_PATH)" ${OTHER_OPTS[@]}
    else
        claude --model=haiku ${OTHER_OPTS[@]}
    fi
elif [ "$CLAUDE_OPT" = "hu" ]; then
    if [ -f "$PROMPT_PATH" ] ;then
        claude --model=haiku --append-system-prompt "/sc:implement --ultrathink --seq --c7 --play --iterative --with-tests$(echo )$(cat $PROMPT_PATH)" ${OTHER_OPTS[@]}
    else
        claude --model=haiku --append-system-prompt "/sc:implement --ultrathink --seq --c7 --play --iterative --with-tests" ${OTHER_OPTS[@]}
    fi
else
    if [ -f "$PROMPT_PATH" ] ;then
        claude --model=sonnet --append-system-prompt "$(cat $PROMPT_PATH)" ${OTHER_OPTS[@]}
    else
        claude --model=sonnet ${OTHER_OPTS[@]}
    fi
fi

